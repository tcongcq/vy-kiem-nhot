
(function(a,b){if(typeof define==="function"&&define.amd){define("wavesurfer",[],function(){return(a.WaveSurfer=b())})}else{if(typeof exports==="object"){module.exports=b()}else{a.WaveSurfer=b()}}}(this,function(){var a={defaultParams:{height:128,waveColor:"#999",progressColor:"#555",cursorColor:"#333",cursorWidth:1,skipLength:2,minPxPerSec:20,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,fillParent:true,scrollParent:false,hideScrollbar:false,normalize:false,audioContext:null,container:null,dragSelection:true,loopSelection:true,audioRate:1,interact:true,splitChannels:false,mediaContainer:null,mediaControls:false,renderer:"Canvas",backend:"WebAudio",mediaType:"audio",autoCenter:true},init:function(b){this.params=a.util.extend({},this.defaultParams,b);this.container="string"==typeof b.container?document.querySelector(this.params.container):this.params.container;if(!this.container){throw new Error("Container element not found")}if(this.params.mediaContainer==null){this.mediaContainer=this.container}else{if(typeof this.params.mediaContainer=="string"){this.mediaContainer=document.querySelector(this.params.mediaContainer)}else{this.mediaContainer=this.params.mediaContainer}}if(!this.mediaContainer){throw new Error("Media Container element not found")}this.savedVolume=0;this.isMuted=false;this.tmpEvents=[];this.currentAjax=null;this.createDrawer();this.createBackend();this.isDestroyed=false},createDrawer:function(){var b=this;this.drawer=Object.create(a.Drawer[this.params.renderer]);this.drawer.init(this.container,this.params);this.drawer.on("redraw",function(){b.drawBuffer();b.drawer.progress(b.backend.getPlayedPercents())});this.drawer.on("click",function(d,c){setTimeout(function(){b.seekTo(c)},0)});this.drawer.on("scroll",function(c){b.fireEvent("scroll",c)})},createBackend:function(){var b=this;if(this.backend){this.backend.destroy()}if(this.params.backend=="AudioElement"){this.params.backend="MediaElement"}if(this.params.backend=="WebAudio"&&!a.WebAudio.supportsWebAudio()){this.params.backend="MediaElement"}this.backend=Object.create(a[this.params.backend]);this.backend.init(this.params);this.backend.on("finish",function(){b.fireEvent("finish")});this.backend.on("play",function(){b.fireEvent("play")});this.backend.on("pause",function(){b.fireEvent("pause")});this.backend.on("audioprocess",function(c){b.drawer.progress(b.backend.getPlayedPercents());b.fireEvent("audioprocess",c)})},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(c,b){this.fireEvent("interaction",this.play.bind(this,c,b));this.backend.play(c,b)},pause:function(){this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return !this.backend.isPaused()},skipBackward:function(b){this.skip(-b||-this.params.skipLength)},skipForward:function(b){this.skip(b||this.params.skipLength)},skip:function(d){var b=this.getCurrentTime()||0;var c=this.getDuration()||1;b=Math.max(0,Math.min(c,b+(d||0)));this.seekAndCenter(b/c)},seekAndCenter:function(b){this.seekTo(b);this.drawer.recenter(b)},seekTo:function(c){this.fireEvent("interaction",this.seekTo.bind(this,c));var d=this.backend.isPaused();var b=this.params.scrollParent;if(d){this.params.scrollParent=false}this.backend.seekTo(c*this.getDuration());this.drawer.progress(this.backend.getPlayedPercents());if(!d){this.backend.pause();this.backend.play()}this.params.scrollParent=b;this.fireEvent("seek",c)},stop:function(){this.pause();this.seekTo(0);this.drawer.progress(0)},setVolume:function(b){this.backend.setVolume(b)},setPlaybackRate:function(b){this.backend.setPlaybackRate(b)},toggleMute:function(){if(this.isMuted){this.backend.setVolume(this.savedVolume);this.isMuted=false}else{this.savedVolume=this.backend.getVolume();this.backend.setVolume(0);this.isMuted=true}},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var e=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio);var d=this.drawer.getWidth();var c=e;if(this.params.fillParent&&(!this.params.scrollParent||e<d)){c=d}var b=this.backend.getPeaks(c);this.drawer.drawPeaks(b,c);this.fireEvent("redraw",b,c)},zoom:function(b){this.params.minPxPerSec=b;this.params.scrollParent=true;this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",b)},loadArrayBuffer:function(b){this.decodeArrayBuffer(b,function(c){if(!this.isDestroyed){this.loadDecodedBuffer(c)}}.bind(this))},loadDecodedBuffer:function(b){this.backend.load(b);this.drawBuffer();this.fireEvent("ready")},loadBlob:function(c){var d=this;var b=new FileReader();b.addEventListener("progress",function(f){d.onProgress(f)});b.addEventListener("load",function(f){d.loadArrayBuffer(f.target.result)});b.addEventListener("error",function(){d.fireEvent("error","Error reading file")});b.readAsArrayBuffer(c);this.empty()},load:function(c,b){this.empty();switch(this.params.backend){case"WebAudio":return this.loadBuffer(c,b);case"MediaElement":return this.loadMediaElement(c,b)}},loadBuffer:function(c,b){var d=(function(e){if(e){this.tmpEvents.push(this.once("ready",e))}return this.getArrayBuffer(c,this.loadArrayBuffer.bind(this))}).bind(this);if(b){this.backend.setPeaks(b);this.drawBuffer();this.tmpEvents.push(this.once("interaction",d))}else{return d()}},loadMediaElement:function(e,b){var d=e;if(typeof e==="string"){this.backend.load(d,this.mediaContainer,b)}else{var c=e;this.backend.loadElt(c,b);d=c.src}this.tmpEvents.push(this.backend.once("canplay",(function(){this.drawBuffer();this.fireEvent("ready")}).bind(this)),this.backend.once("error",(function(f){this.fireEvent("error",f)}).bind(this)));if(b){this.backend.setPeaks(b)}else{if(this.backend.supportsWebAudio()){this.getArrayBuffer(d,(function(f){this.decodeArrayBuffer(f,(function(g){this.backend.buffer=g;this.drawBuffer()}).bind(this))}).bind(this))}}},decodeArrayBuffer:function(b,c){this.arraybuffer=b;this.backend.decodeArrayBuffer(b,(function(d){if(!this.isDestroyed&&this.arraybuffer==b){c(d);this.arraybuffer=null}}).bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(b,e){var d=this;var c=a.util.ajax({url:b,responseType:"arraybuffer"});this.currentAjax=c;this.tmpEvents.push(c.on("progress",function(f){d.onProgress(f)}),c.on("success",function(f,g){e(f);d.currentAjax=null}),c.on("error",function(f){d.fireEvent("error","XHR error: "+f.target.statusText);d.currentAjax=null}));return c},onProgress:function(c){if(c.lengthComputable){var b=c.loaded/c.total}else{b=c.loaded/(c.loaded+1000000)}this.fireEvent("loading",Math.round(b*100),c.target)},exportPCM:function(f,g,d){f=f||1024;g=g||10000;d=d||false;var c=this.backend.getPeaks(f,g);var b=[].map.call(c,function(h){return Math.round(h*g)/g});var e=JSON.stringify(b);if(!d){window.open("data:application/json;charset=utf-8,"+encodeURIComponent(e))}return e},exportImage:function(b,c){if(!b){b="image/png"}if(!c){c=1}return this.drawer.getImage(b,c)},cancelAjax:function(){if(this.currentAjax){this.currentAjax.xhr.abort();this.currentAjax=null}},clearTmpEvents:function(){this.tmpEvents.forEach(function(b){b.un()})},empty:function(){if(!this.backend.isPaused()){this.stop();this.backend.disconnectSource()}this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();this.backend.destroy();this.drawer.destroy();this.isDestroyed=true}};a.create=function(c){var b=Object.create(a);b.init(c);return b};a.util={extend:function(c){var b=Array.prototype.slice.call(arguments,1);b.forEach(function(d){Object.keys(d).forEach(function(e){c[e]=d[e]})});return c},min:function(b){var d=+Infinity;for(var c in b){if(b[c]<d){d=b[c]}}return d},max:function(c){var b=-Infinity;for(var d in c){if(c[d]>b){b=c[d]}}return b},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(b){var d=Object.create(a.Observer);var e=new XMLHttpRequest();var c=false;e.open(b.method||"GET",b.url,true);e.responseType=b.responseType||"json";e.addEventListener("progress",function(f){d.fireEvent("progress",f);if(f.lengthComputable&&f.loaded==f.total){c=true}});e.addEventListener("load",function(f){if(!c){d.fireEvent("progress",f)}d.fireEvent("load",f);if(200==e.status||206==e.status){d.fireEvent("success",e.response,f)}else{d.fireEvent("error",f)}});e.addEventListener("error",function(f){d.fireEvent("error",f)});e.send();d.xhr=e;return d}};a.Observer={on:function(d,c){if(!this.handlers){this.handlers={}}var b=this.handlers[d];if(!b){b=this.handlers[d]=[]}b.push(c);return{name:d,callback:c,un:this.un.bind(this,d,c)}},un:function(e,d){if(!this.handlers){return}var b=this.handlers[e];if(b){if(d){for(var c=b.length-1;c>=0;c--){if(b[c]==d){b.splice(c,1)}}}else{b.length=0}}},unAll:function(){this.handlers=null},once:function(d,c){var e=this;var b=function(){c.apply(this,arguments);setTimeout(function(){e.un(d,b)},0)};return this.on(d,b)},fireEvent:function(d){if(!this.handlers){return}var b=this.handlers[d];var c=Array.prototype.slice.call(arguments,1);b&&b.forEach(function(e){e.apply(null,c)})}};a.util.extend(a,a.Observer);"use strict";a.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return !!(window.AudioContext||window.webkitAudioContext)},getAudioContext:function(){if(!a.WebAudio.audioContext){a.WebAudio.audioContext=new (window.AudioContext||window.webkitAudioContext)}return a.WebAudio.audioContext},getOfflineAudioContext:function(b){if(!a.WebAudio.offlineAudioContext){a.WebAudio.offlineAudioContext=new (window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,b)}return a.WebAudio.offlineAudioContext},init:function(b){this.params=b;this.ac=b.audioContext||this.getAudioContext();this.lastPlay=this.ac.currentTime;this.startPosition=0;this.scheduledPause=null;this.states=[Object.create(a.WebAudio.state.playing),Object.create(a.WebAudio.state.paused),Object.create(a.WebAudio.state.finished)];this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(this.PAUSED_STATE);this.setPlaybackRate(this.params.audioRate)},disconnectFilters:function(){if(this.filters){this.filters.forEach(function(b){b&&b.disconnect()});this.filters=null;this.analyser.connect(this.gainNode)}},setState:function(b){if(this.state!==this.states[b]){this.state=this.states[b];this.state.init.call(this)}},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(b){this.disconnectFilters();if(b&&b.length){this.filters=b;this.analyser.disconnect();b.reduce(function(c,d){c.connect(d);return d},this.analyser).connect(this.gainNode)}},createScriptNode:function(){if(this.ac.createScriptProcessor){this.scriptNode=this.ac.createScriptProcessor(this.scriptBufferSize)}else{this.scriptNode=this.ac.createJavaScriptNode(this.scriptBufferSize)}this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var b=this;this.scriptNode.onaudioprocess=function(){var c=b.getCurrentTime();if(c>=b.getDuration()){b.setState(b.FINISHED_STATE);b.fireEvent("pause")}else{if(c>=b.scheduledPause){b.pause()}else{if(b.state===b.states[b.PLAYING_STATE]){b.fireEvent("audioprocess",c)}}}}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)},createVolumeNode:function(){if(this.ac.createGain){this.gainNode=this.ac.createGain()}else{this.gainNode=this.ac.createGainNode()}this.gainNode.connect(this.ac.destination)},setVolume:function(b){this.gainNode.gain.value=b},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(c,d,b){if(!this.offlineAc){this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)}this.offlineAc.decodeAudioData(c,(function(e){d(e)}).bind(this),b)},setPeaks:function(b){this.peaks=b},getPeaks:function(d){if(this.peaks){return this.peaks}var e=this.buffer.length/d;var n=~~(e/10)||1;var o=this.buffer.numberOfChannels;var h=[];var t=[];for(var p=0;p<o;p++){var r=h[p]=[];var f=this.buffer.getChannelData(p);for(var m=0;m<d;m++){var b=~~(m*e);var g=~~(b+e);var l=0;var q=0;for(var k=b;k<g;k+=n){var s=f[k];if(s>q){q=s}if(s<l){l=s}}r[2*m]=q;r[2*m+1]=l;if(p==0||q>t[2*m]){t[2*m]=q}if(p==0||l<t[2*m+1]){t[2*m+1]=l}}}return this.params.splitChannels?h:t},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){if(this.source){this.source.disconnect()}},destroy:function(){if(!this.isPaused()){this.pause()}this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect()},load:function(b){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=b;this.createSource()},createSource:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.value=this.playbackRate;this.source.buffer=this.buffer;this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){if(!this.buffer){return 0}return this.buffer.duration},seekTo:function(c,b){if(!this.buffer){return}this.scheduledPause=null;if(c==null){c=this.getCurrentTime();if(c>=this.getDuration()){c=0}}if(b==null){b=this.getDuration()}this.startPosition=c;this.lastPlay=this.ac.currentTime;if(this.state===this.states[this.FINISHED_STATE]){this.setState(this.PAUSED_STATE)}return{start:c,end:b}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(d,c){if(!this.buffer){return}this.createSource();var b=this.seekTo(d,c);d=b.start;c=b.end;this.scheduledPause=c;this.source.start(0,d,c-d);this.setState(this.PLAYING_STATE);this.fireEvent("play")},pause:function(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(this.PAUSED_STATE);this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},setPlaybackRate:function(b){b=b||1;if(this.isPaused()){this.playbackRate=b}else{this.pause();this.playbackRate=b;this.play()}}};a.WebAudio.state={};a.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var b=this.getDuration();return(this.getCurrentTime()/b)||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}};a.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var b=this.getDuration();return(this.getCurrentTime()/b)||0},getCurrentTime:function(){return this.startPosition}};a.WebAudio.state.finished={init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}};a.util.extend(a.WebAudio,a.Observer);"use strict";a.MediaElement=Object.create(a.WebAudio);a.util.extend(a.MediaElement,{init:function(b){this.params=b;this.media={currentTime:0,duration:0,paused:true,playbackRate:1,play:function(){},pause:function(){}};this.mediaType=b.mediaType.toLowerCase();this.elementPosition=b.elementPosition;this.setPlaybackRate(this.params.audioRate);this.createTimer()},createTimer:function(){var d=this;var c=false;var b=function(){if(d.isPaused()){return}d.fireEvent("audioprocess",d.getCurrentTime());var e=window.requestAnimationFrame||window.webkitRequestAnimationFrame;e(b)};this.on("play",b)},load:function(d,b,c){var f=this;var e=document.createElement(this.mediaType);e.controls=this.params.mediaControls;e.autoplay=this.params.autoplay||false;e.preload="auto";e.src=d;e.style.width="100%";var g=b.querySelector(this.mediaType);if(g){b.removeChild(g)}b.appendChild(e);this._load(e,c)},loadElt:function(c,b){var e=this;var d=c;d.controls=this.params.mediaControls;d.autoplay=this.params.autoplay||false;this._load(d,b)},_load:function(d,b){var c=this;d.load();d.addEventListener("error",function(){c.fireEvent("error","Error loading media element")});d.addEventListener("canplay",function(){c.fireEvent("canplay")});d.addEventListener("ended",function(){c.fireEvent("finish")});this.media=d;this.peaks=b;this.onPlayEnd=null;this.buffer=null;this.setPlaybackRate(this.playbackRate)},isPaused:function(){return !this.media||this.media.paused},getDuration:function(){var b=this.media.duration;if(b>=Infinity){b=this.media.seekable.end(0)}return b},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return(this.getCurrentTime()/this.getDuration())||0},setPlaybackRate:function(b){this.playbackRate=b||1;this.media.playbackRate=this.playbackRate},seekTo:function(b){if(b!=null){this.media.currentTime=b}this.clearPlayEnd()},play:function(c,b){this.seekTo(c);this.media.play();b&&this.setPlayEnd(b);this.fireEvent("play")},pause:function(){this.media&&this.media.pause();this.clearPlayEnd();this.fireEvent("pause")},setPlayEnd:function(b){var c=this;this.onPlayEnd=function(d){if(d>=b){c.pause();c.seekTo(b)}};this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){if(this.onPlayEnd){this.un("audioprocess",this.onPlayEnd);this.onPlayEnd=null}},getPeaks:function(b){if(this.buffer){return a.WebAudio.getPeaks.call(this,b)}return this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(b){this.media.volume=b},destroy:function(){this.pause();this.unAll();this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media);this.media=null}});a.AudioElement=a.MediaElement;"use strict";a.Drawer={init:function(b,c){this.container=b;this.params=c;this.width=0;this.height=c.height*this.params.pixelRatio;this.lastPos=0;this.initDrawer(c);this.createWrapper();this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"})}this.setupWrapperEvents()},handleEvent:function(g,c){!c&&g.preventDefault();var f=g.targetTouches?g.targetTouches[0].clientX:g.clientX;var h=this.wrapper.getBoundingClientRect();var i=this.width;var d=this.getWidth();var b;if(!this.params.fillParent&&i<d){b=((f-h.left)*this.params.pixelRatio/i)||0;if(b>1){b=1}}else{b=((f-h.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth)||0}return b},setupWrapperEvents:function(){var b=this;this.wrapper.addEventListener("click",function(c){var f=b.wrapper.offsetHeight-b.wrapper.clientHeight;if(f!=0){var d=b.wrapper.getBoundingClientRect();if(c.clientY>=d.bottom-f){return}}if(b.params.interact){b.fireEvent("click",c,b.handleEvent(c))}});this.wrapper.addEventListener("scroll",function(c){b.fireEvent("scroll",c)})},drawPeaks:function(b,c){this.resetScroll();this.setWidth(c);this.params.barWidth?this.drawBars(b):this.drawWave(b)},style:function(b,c){Object.keys(c).forEach(function(d){if(b.style[d]!==c[d]){b.style[d]=c[d]}});return b},resetScroll:function(){if(this.wrapper!==null){this.wrapper.scrollLeft=0}},recenter:function(c){var b=this.wrapper.scrollWidth*c;this.recenterOnPosition(b,true)},recenterOnPosition:function(b,c){var i=this.wrapper.scrollLeft;var f=~~(this.wrapper.clientWidth/2);var g=b-f;var h=g-i;var e=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(e==0){return}if(!c&&-f<=h&&h<f){var d=5;h=Math.max(-d,Math.min(d,h));g=i+h}g=Math.max(0,Math.min(e,g));if(g!=i){this.wrapper.scrollLeft=g}},getWidth:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(b){this.width=b;if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:""})}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"})}this.updateSize()},setHeight:function(b){if(b==this.height){return}this.height=b;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize()},progress:function(c){var b=1/this.params.pixelRatio;var e=Math.round(c*this.width)*b;if(e<this.lastPos||e-this.lastPos>=b){this.lastPos=e;if(this.params.scrollParent&&this.params.autoCenter){var d=~~(this.wrapper.scrollWidth*c);this.recenterOnPosition(d)}this.updateProgress(c)}},destroy:function(){this.unAll();if(this.wrapper){this.container.removeChild(this.wrapper);this.wrapper=null}},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(c,b){},clearWave:function(){},updateProgress:function(b){}};a.util.extend(a.Drawer,a.Observer);"use strict";a.Drawer.Canvas=Object.create(a.Drawer);a.util.extend(a.Drawer.Canvas,{createElements:function(){var c=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));this.waveCc=c.getContext("2d");this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor}));if(this.params.waveColor!=this.params.progressColor){var b=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=b.getContext("2d")}},updateSize:function(){var b=Math.round(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width;this.waveCc.canvas.height=this.height;this.style(this.waveCc.canvas,{width:b+"px"});this.style(this.progressWave,{display:"block"});if(this.progressCc){this.progressCc.canvas.width=this.width;this.progressCc.canvas.height=this.height;this.style(this.progressCc.canvas,{width:b+"px"})}this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height);if(this.progressCc){this.progressCc.clearRect(0,0,this.width,this.height)}},drawBars:function(n,e){if(n[0] instanceof Array){var i=n;if(this.params.splitChannels){this.setHeight(i.length*this.params.height*this.params.pixelRatio);i.forEach(this.drawBars,this);return}else{n=i[0]}}var k=[].some.call(n,function(q){return q<0});if(k){n=[].filter.call(n,function(r,q){return q%2==0})}var h=0.5/this.params.pixelRatio;var b=this.width;var o=this.params.height*this.params.pixelRatio;var g=o*e||0;var j=o/2;var c=n.length;var l=this.params.barWidth*this.params.pixelRatio;var m=Math.max(this.params.pixelRatio,~~(l/2));var d=l+m;var p=1;if(this.params.normalize){p=a.util.max(n)}var f=c/b;this.waveCc.fillStyle=this.params.waveColor;if(this.progressCc){this.progressCc.fillStyle=this.params.progressColor}[this.waveCc,this.progressCc].forEach(function(s){if(!s){return}for(var q=0;q<b;q+=d){var r=Math.round(n[Math.floor(q*f)]/p*j);s.fillRect(q+h,j-r+g,l+h,r*2)}},this)},drawWave:function(p,d){if(p[0] instanceof Array){var l=p;if(this.params.splitChannels){this.setHeight(l.length*this.params.height*this.params.pixelRatio);l.forEach(this.drawWave,this);return}else{p=l[0]}}var b=[].some.call(p,function(i){return i<0});if(!b){var g=[];for(var k=0,n=p.length;k<n;k++){g[2*k]=p[k];g[2*k+1]=-p[k]}p=g}var j=0.5/this.params.pixelRatio;var q=this.params.height*this.params.pixelRatio;var h=q*d||0;var m=q/2;var c=~~(p.length/2);var e=1;if(this.params.fillParent&&this.width!=c){e=this.width/c}var r=1;if(this.params.normalize){var o=a.util.max(p);var f=a.util.min(p);r=-f>o?-f:o}this.waveCc.fillStyle=this.params.waveColor;if(this.progressCc){this.progressCc.fillStyle=this.params.progressColor}[this.waveCc,this.progressCc].forEach(function(u){if(!u){return}u.beginPath();u.moveTo(j,m+h);for(var s=0;s<c;s++){var t=Math.round(p[2*s]/r*m);u.lineTo(s*e+j,m-t+h)}for(var s=c-1;s>=0;s--){var t=Math.round(p[2*s+1]/r*m);u.lineTo(s*e+j,m-t+h)}u.closePath();u.fill();u.fillRect(0,m+h-j,this.width,j)},this)},updateProgress:function(b){var c=Math.round(this.width*b)/this.params.pixelRatio;this.style(this.progressWave,{width:c+"px"})},getImage:function(b,c){return this.waveCc.canvas.toDataURL(b,c)}});"use strict";a.Drawer.MultiCanvas=Object.create(a.Drawer);a.util.extend(a.Drawer.MultiCanvas,{initDrawer:function(b){this.maxCanvasWidth=b.maxCanvasWidth!=null?b.maxCanvasWidth:4000;this.maxCanvasElementWidth=Math.round(this.maxCanvasWidth/this.params.pixelRatio);if(this.maxCanvasWidth<=1){throw"maxCanvasWidth must be greater than 1."}else{if(this.maxCanvasWidth%2==1){throw"maxCanvasWidth must be an even number."}}this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor;this.halfPixel=0.5/this.params.pixelRatio;this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor}));this.addCanvas()},updateSize:function(){var c=Math.round(this.width/this.params.pixelRatio),d=Math.ceil(c/this.maxCanvasElementWidth);while(this.canvases.length<d){this.addCanvas()}while(this.canvases.length>d){this.removeCanvas()}for(var e in this.canvases){var b=this.maxCanvasWidth+2*Math.ceil(this.params.pixelRatio/2);if(e==this.canvases.length-1){b=this.width-(this.maxCanvasWidth*(this.canvases.length-1))}this.updateDimensions(this.canvases[e],b,this.height);this.clearWaveForEntry(this.canvases[e])}},addCanvas:function(){var b={},c=this.maxCanvasElementWidth*this.canvases.length;b.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:c+"px",top:0,bottom:0}));b.waveCtx=b.wave.getContext("2d");if(this.hasProgressCanvas){b.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:c+"px",top:0,bottom:0}));b.progressCtx=b.progress.getContext("2d")}this.canvases.push(b)},removeCanvas:function(){var b=this.canvases.pop();b.wave.parentElement.removeChild(b.wave);if(this.hasProgressCanvas){b.progress.parentElement.removeChild(b.progress)}},updateDimensions:function(e,d,c){var f=Math.round(d/this.params.pixelRatio),b=Math.round(this.width/this.params.pixelRatio);e.start=(e.waveCtx.canvas.offsetLeft/b)||0;e.end=e.start+f/b;e.waveCtx.canvas.width=d;e.waveCtx.canvas.height=c;this.style(e.waveCtx.canvas,{width:f+"px"});this.style(this.progressWave,{display:"block"});if(this.hasProgressCanvas){e.progressCtx.canvas.width=d;e.progressCtx.canvas.height=c;this.style(e.progressCtx.canvas,{width:f+"px"})}},clearWave:function(){for(var b in this.canvases){this.clearWaveForEntry(this.canvases[b])}},clearWaveForEntry:function(b){b.waveCtx.clearRect(0,0,b.waveCtx.canvas.width,b.waveCtx.canvas.height);if(this.hasProgressCanvas){b.progressCtx.clearRect(0,0,b.progressCtx.canvas.width,b.progressCtx.canvas.height)}},drawBars:function(q,e){if(q[0] instanceof Array){var l=q;if(this.params.splitChannels){this.setHeight(l.length*this.params.height*this.params.pixelRatio);l.forEach(this.drawBars,this);return}else{q=l[0]}}var n=[].some.call(q,function(h){return h<0});if(n){q=[].filter.call(q,function(i,h){return h%2==0})}var b=this.width;var r=this.params.height*this.params.pixelRatio;var j=r*e||0;var m=r/2;var c=q.length;var o=this.params.barWidth*this.params.pixelRatio;var p=Math.max(this.params.pixelRatio,~~(o/2));var d=o+p;var s=1;if(this.params.normalize){s=a.util.max(q)}var f=c/b;for(var g=0;g<b;g+=d){var k=Math.round(q[Math.floor(g*f)]/s*m);this.fillRect(g+this.halfPixel,m-k+j,o+this.halfPixel,k*2)}},drawWave:function(m,c){if(m[0] instanceof Array){var h=m;if(this.params.splitChannels){this.setHeight(h.length*this.params.height*this.params.pixelRatio);h.forEach(this.drawWave,this);return}else{m=h[0]}}var b=[].some.call(m,function(i){return i<0});if(!b){var e=[];for(var g=0,k=m.length;g<k;g++){e[2*g]=m[g];e[2*g+1]=-m[g]}m=e}var n=this.params.height*this.params.pixelRatio;var f=n*c||0;var j=n/2;var o=1;if(this.params.normalize){var l=a.util.max(m);var d=a.util.min(m);o=-d>l?-d:l}this.drawLine(m,o,j,f);this.fillRect(0,j+f-this.halfPixel,this.width,this.halfPixel)},drawLine:function(b,d,g,f){for(var c in this.canvases){var e=this.canvases[c];this.setFillStyles(e);this.drawLineToContext(e,e.waveCtx,b,d,g,f);this.drawLineToContext(e,e.progressCtx,b,d,g,f)}},drawLineToContext:function(l,n,k,o,j,e){if(!n){return}var b=k.length/2;var c=1;if(this.params.fillParent&&this.width!=b){c=this.width/b}var g=Math.round(b*l.start),m=Math.round(b*l.end);n.beginPath();n.moveTo(this.halfPixel,j+e);for(var d=g;d<m;d++){var f=Math.round(k[2*d]/o*j);n.lineTo((d-g)*c+this.halfPixel,j-f+e)}for(var d=m-1;d>=g;d--){var f=Math.round(k[2*d+1]/o*j);n.lineTo((d-g)*c+this.halfPixel,j-f+e)}n.closePath();n.fill()},fillRect:function(c,j,e,b){for(var d in this.canvases){var f=this.canvases[d],g=d*this.maxCanvasWidth;var h={x1:Math.max(c,d*this.maxCanvasWidth),y1:j,x2:Math.min(c+e,d*this.maxCanvasWidth+f.waveCtx.canvas.width),y2:j+b};if(h.x1<h.x2){this.setFillStyles(f);this.fillRectToContext(f.waveCtx,h.x1-g,h.y1,h.x2-h.x1,h.y2-h.y1);this.fillRectToContext(f.progressCtx,h.x1-g,h.y1,h.x2-h.x1,h.y2-h.y1)}}},fillRectToContext:function(d,c,f,e,b){if(!d){return}d.fillRect(c,f,e,b)},setFillStyles:function(b){b.waveCtx.fillStyle=this.params.waveColor;if(this.hasProgressCanvas){b.progressCtx.fillStyle=this.params.progressColor}},updateProgress:function(b){var c=Math.round(this.width*b)/this.params.pixelRatio;this.style(this.progressWave,{width:c+"px"})}});"use strict";(function(){var b=function(){var c=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(c,function(f){var g=a.util.extend({container:f,backend:"MediaElement",mediaControls:true},f.dataset);f.style.display="block";var d=a.create(g);if(f.dataset.peaks){var e=JSON.parse(f.dataset.peaks)}d.load(f.dataset.url,e)})};if(document.readyState==="complete"){b()}else{window.addEventListener("load",b)}}());return a}));